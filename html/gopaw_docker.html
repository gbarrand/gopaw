<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>&lt;h2&gt;Docker&lt;/h2&gt;</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><h2>Docker</h2>
</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><br />
 gopaw exists under gbarrand/gopaw on:</p>
<p><a href="https://hub.docker.com" target="_blank">https://hub.docker.com</a> </p>
<h1><a class="anchor" id="gopaw_docker_pull"></a>
docker pull</h1>
<p>To get an image, for example on a Mac: </p><pre class="fragment">     macOS&gt; docker login  # to login on hub.docker.com
     macOS&gt; docker pull gbarrand/gopaw:&lt;version&gt;
</pre><p> On some platforms, you may have to "sudo" the upper commands.</p>
<h1><a class="anchor" id="gopaw_docker_x11_before_mojave"></a>
Setup X11 and run on macOS before Mojave</h1>
<p>As it is a X11 app, you have to setup the DISPLAY. On a Mac with XQuartz: </p><pre class="fragment">     macOS&gt; ifconfig  # to get your IP address.
        sh&gt; DISPLAY=&lt;IP&gt;:0;export DISPLAY
     ( csh&gt; setenv DISPLAY &lt;IP&gt;:0 )
     macOS&gt; xhost + &lt;IP&gt;
     macOS&gt; docker run -e DISPLAY=${DISPLAY} -v /tmp/.X11-unix:/tmp/.X11-unix:rw -t -i gbarrand/gopaw:&lt;version&gt; 
</pre><p> Note the options "-t -i" that permit to redirect the standard input/output on your host terminal.</p>
<h1><a class="anchor" id="gopaw_docker_x11_mojave"></a>
Setup X11 and run on macOS with Mojave</h1>
<p>The upper does not work on Mojave, but the below ansatz, found on stackerflow, works for us : </p><pre class="fragment">    mojave&gt; &lt;open a new terminal&gt;
    movaje&gt; &lt;install socat. We installed it with Macports by doing "sudo port install socat"&gt;
    movaje&gt; &lt;be sure that the socat app is in your path&gt;
</pre><p> Check that the port 6000 is not used with : </p><pre class="fragment">    mojave&gt; lsof -i TCP:6000
</pre><p> then do : </p><pre class="fragment">   socat TCP-LISTEN:6000,reuseaddr,fork UNIX-CLIENT:\"$DISPLAY\" &amp;
</pre><p> then another "lsof -i TCP:6000" should give something as : </p><pre class="fragment">   COMMAND   PID    USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
   socat   23420 barrand    5u  IPv4 0x4e5bb941508d0a39      0t0  TCP *:6000 (LISTEN)
</pre><p> and then, the following command works for us : </p><pre class="fragment">   docker run -e DISPLAY=docker.for.mac.host.internal:0 -v /tmp/.X11-unix:/tmp/.X11-unix:rw -t -i gbarrand/gopaw:&lt;version&gt;
</pre><h1><a class="anchor" id="gopaw_docker_x11_Windows"></a>
Setup X11 and run on Windows</h1>
<p>On a Windows-10 with the X11/Xming server, from XLaunch, start Xming with "on" in the "No Access Control" box, or from the DOS prompt : </p><pre class="fragment">    DOS&gt; Xming :0 -multiwindow -clipboard -ac
 (you may have to kill Xming from "Task manager"), and :
    DOS&gt; docker run -e DISPLAY=10.0.75.1:0 -t -i gbarrand/gopaw:&lt;version&gt;
</pre><h1><a class="anchor" id="gopaw_docker_examples"></a>
Running some examples</h1>
<p>In the container, gopaw is installed under /app/gopaw/&lt;version&gt;/[bin,res]. You can execute some examples with something as: </p><pre class="fragment">    GOPAW&gt; lcd /app/gopaw/&lt;version&gt;/res/gopaw/examples/py_root
    GOPAW&gt; exec pawex10
</pre><p> If producing a file, for example here mandel.ps, whilst the container is still running, you can get it on your host with: </p><pre class="fragment">     host&gt; docker ps  # to get the container id.
     host&gt; docker cp &lt;container id&gt;:/app/gopaw/&lt;version&gt;/res/gopaw/examples/py_root/mandel.ps .
</pre><p>You can check that g4tools/HDF5, FITS and CERN-ROOT file reading works with : </p><pre class="fragment">    GOPAW&gt; lcd /app/gopaw/&lt;version&gt;/res/gopaw/examples/gopaw
    GOPAW&gt; exec B4      | read the data_B4.hdf5 file.
    GOPAW&gt; exec sdss    | read the data_fpC-005820-g1-0024.fits file.
    GOPAW&gt; exec hst     | read the data_hst-img-2010x1890.fits file.
    GOPAW&gt; exec m51     | read the data_m51.fits file.
    GOPAW&gt; exec pawdemo | read the data_pawdemo.root file.
</pre><h1><a class="anchor" id="gopaw_docker_mount"></a>
Mount a local host directory</h1>
<p>To work with a local host directory, for example /tmp/work_dir on a Mac : </p><pre class="fragment">     mkdir -p /tmp/work_dir
     cd /tmp/work_dir
</pre><p> have here a my.kumac file with in it : </p><pre class="fragment">     vector/create VECT1(10)
     vector/input VECT1 10 8 6 4 2 3 5 7 9 11
     v/draw vect1
     /picture/print out.png
</pre><p> Then launch docker/gopaw by mounting /tmp/work_dir on /work_dir by adding in the upper docker run command : </p><pre class="fragment">     -v /tmp/work_dir:/work_dir:rw
</pre><p> From gopaw, have : </p><pre class="fragment">     GOPAW&gt; lcd /work_dir
     GOPAW&gt; lls
     GOPAW&gt; exec my_kumac
     GOPAW&gt; exit
</pre><p> You should have in the local host /tmp/work_dir a out.png file. </p><div class="image">
<img src="docker.png" alt="docker.png"/>
</div>
 </div></div><!-- contents -->

</body>
</html>
